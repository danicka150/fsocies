
<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>Fsociety Board</title>
</head>
<body>

<h1>Fsociety Board</h1>

<div id="auth">
  <input id="username" placeholder="Username">
  <input id="password" type="password" placeholder="Password">
  <button onclick="register()">Register</button>
  <button onclick="login()">Login</button>
</div>

<div id="user"></div>

<hr>

<h2>Create Thread</h2>
<input id="threadTitle" placeholder="Thread title">
<button onclick="createThread()">Create</button>

<hr>

<h2>Threads</h2>
<div id="threads"></div>

<script>
async function register() {
  const username = usernameInput.value;
  const password = passwordInput.value;

  const res = await fetch("/api/register", {
    method: "POST",
    headers: {"Content-Type":"application/json"},
    body: JSON.stringify({username, password})
  });

  const data = await res.json();
  if (data.success) {
    updateUser(data.user);
  } else {
    alert(data.message);
  }
}

async function login() {
  const username = usernameInput.value;
  const password = passwordInput.value;

  const res = await fetch("/api/login", {
    method: "POST",
    headers: {"Content-Type":"application/json"},
    body: JSON.stringify({username, password})
  });

  const data = await res.json();
  if (data.success) {
    updateUser(data.user);
  } else {
    alert(data.message);
  }
}

function updateUser(user) {
  document.getElementById("auth").style.display = "none";
  document.getElementById("user").innerText = "Вы вошли как: " + user.username;
}

async function checkUser() {
  const res = await fetch("/api/me");
  const data = await res.json();
  if (data.user) {
    updateUser(data.user);
  }
}

async function createThread() {
  const title = threadTitle.value;

  const res = await fetch("/api/thread", {
    method:"POST",
    headers:{"Content-Type":"application/json"},
    body: JSON.stringify({title})
  });

  const data = await res.json();
  if (data.success) {
    loadThreads();
  } else {
    alert(data.message);
  }
}

async function loadThreads() {
  const res = await fetch("/api/threads");
  const data = await res.json();

  const container = document.getElementById("threads");
  container.innerHTML = "";

  data.forEach(t => {
    container.innerHTML += "<p><b>" + t.title + "</b> — " + t.username + "</p>";
  });
}

checkUser();
loadThreads();
</script>

</body>
</html>

