
<body>
  <div id="loginStatus"></div>
  <div id="authForm">
    <input id="username" placeholder="Ник">
    <input id="password" placeholder="Пароль" type="password">
    <button id="registerBtn">Регистрация</button>
    <button id="loginBtn">Войти</button>
  </div>

  <div id="threadForm" style="display:none;">
    <input id="threadTitle" placeholder="Название треда">
    <textarea id="threadContent" placeholder="Содержимое"></textarea>
    <button id="createThreadBtn">Создать тред</button>
  </div>

  <script>
    // Показываем пользователя, если уже залогинен
    const savedUser = localStorage.getItem('username');
    if (savedUser) {
      document.getElementById('loginStatus').innerText = `Вы вошли как ${savedUser}`;
      document.getElementById('authForm').style.display = 'none';
      document.getElementById('threadForm').style.display = 'block';
    }

    // Регистрация
    document.getElementById('registerBtn').onclick = async () => {
      const username = document.getElementById('username').value;
      const password = document.getElementById('password').value;
      const res = await fetch('/api/register', {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify({ username, password })
      });
      const data = await res.json();
      if (data.success) {
        localStorage.setItem('username', username);
        localStorage.setItem('userId', data.id);
        document.getElementById('loginStatus').innerText = `Вы вошли как ${username}`;
        document.getElementById('authForm').style.display = 'none';
        document.getElementById('threadForm').style.display = 'block';
      } else {
        alert(data.error);
      }
    };

    // Вход
    document.getElementById('loginBtn').onclick = async () => {
      const username = document.getElementById('username').value;
      const password = document.getElementById('password').value;
      const res = await fetch('/api/login', {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify({ username, password })
      });
      const data = await res.json();
      if (data.success) {
        localStorage.setItem('username', username);
        localStorage.setItem('userId', data.id);
        document.getElementById('loginStatus').innerText = `Вы вошли как ${username}`;
        document.getElementById('authForm').style.display = 'none';
        document.getElementById('threadForm').style.display = 'block';
      } else {
        alert(data.error);
      }
    };

    // Создание треда
    document.getElementById('createThreadBtn').onclick = async () => {
      const title = document.getElementById('threadTitle').value;
      const content = document.getElementById('threadContent').value;
      const userId = localStorage.getItem('userId');
      if (!userId) return alert('Необходимо войти в аккаунт');

      const res = await fetch('/api/thread', {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify({ title, content, user_id: userId })
      });
      const data = await res.json();
      if (data.success) {
        alert('Тред создан!');
        document.getElementById('threadTitle').value = '';
        document.getElementById('threadContent').value = '';
      } else {
        alert(data.error);
      }
    };
  </script>
</body>

